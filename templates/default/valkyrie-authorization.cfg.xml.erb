<?xml version="1.0" encoding="UTF-8"?>

<valkyrie-authorization xmlns="http://docs.openrepose.org/repose/valkyrie-authorization/v1.0" cache-timeout-millis="<%= @cache_timeout_millis %>" enable-masking-403s="<%= @enable_masking_403s %>">
    <valkyrie-server uri="<%= @valkyrie_server_uri %>" username="<%= @valkyrie_server_username %>" password="<%= @valkyrie_server_password %>"/>
    <translate-permissions-to-roles/> 
    <collection-resources>
        <resource>
            <path-regex>.*/hybrid:\d+/entities</path-regex>
            <collection>
                <json>
                    <path-to-collection>$.values</path-to-collection>
                    <path-to-device-id>
                        <path>$.uri</path>
                        <regex>http://core.rackspace.com/accounts/\d*/devices/(\d*)</regex>
                    </path-to-device-id>
                    <path-to-item-count>$.metadata.count</path-to-item-count>
                </json>
            </collection>
        </resource>
        <resource>
            <path-regex>.*/hybrid:\d+/views/overview</path-regex>
            <collection>
                <json>
                    <path-to-collection>$.values</path-to-collection>
                    <path-to-device-id>
                        <path>$.entity.uri</path>
                        <regex>http://core.rackspace.com/accounts/\d*/devices/(\d*)</regex>
                    </path-to-device-id>
                    <path-to-item-count>$.metadata.count</path-to-item-count>
                </json>
            </collection>
        </resource>
    </collection-resources>
</valkyrie-authorization>
